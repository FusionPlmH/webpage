<!DOCTYPE html>
<html>

<head>
  <title>摄像头和麦克风测试</title>
  <style>
    video {
      width: 100%;
      max-width: 400px;
      margin-bottom: 10px;
      transform-origin: top left;
    }

    .rotated {
      transform: rotate(90deg);
    }

    .rotated180 {
      transform: rotate(180deg);
    }
  </style>
</head>

<body>
  <div style="display: flex; flex-direction: column; align-items: center;">
    <h1>摄像头和麦克风测试</h1>
    <div>
      <video id="videoElement" autoplay></video>
      <audio id="audioElement" autoplay></audio>
    </div>
    <br>
    <button onclick="startCamera()" style="width: 100%;">启动画面捕获</button>
    <br>
    <button onclick="startMicrophone()" style="width: 100%;">启动声音捕获</button>
    <br>
    <br>
    <div id="rotateButtonsContainer">
      <button id="rotateLeftButton" onclick="rotateLeft()">左转90°</button>
      <button id="rotateRightButton" onclick="rotateRight()">右转90°</button>
    </div>
    <br>
    <button onclick="toggleFullscreen()" style="width: 100%;">全屏</button>

    <script>
      const videoElement = document.getElementById('videoElement');
      const audioElement = document.getElementById('audioElement');
      let mediaStream;
      let rotationAngle = 0;

      async function populateDevices() {
        try {
          const devices = await navigator.mediaDevices.enumerateDevices();

          devices.forEach((device) => {
            const option = document.createElement('option');
            option.value = device.deviceId;
            option.text = device.label;

            if (device.kind === 'videoinput') {
              videoElement.srcObject = mediaStream;
            } else if (device.kind === 'audioinput') {
              audioElement.srcObject = mediaStream;
            }
          });
        } catch (error) {
          console.error('无法获取设备列表：', error);
        }
      }

      async function startCamera() {
        try {
          mediaStream = await navigator.mediaDevices.getUserMedia({ video: true });
          videoElement.srcObject = mediaStream;
        } catch (error) {
          console.error('访问摄像头出错：', error);
        }
      }

      async function startMicrophone() {
        try {
          mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
          audioElement.srcObject = mediaStream;
        } catch (error) {
          console.error('访问麦克风出错：', error);
        }
      }

      function rotateLeft() {
        rotationAngle = (rotationAngle - 90) % 360;
        updateRotation();
      }

      function rotateRight() {
        rotationAngle = (rotationAngle + 90) % 360;
        updateRotation();
      }

      function updateRotation() {
        videoElement.style.transform = `rotate(${rotationAngle}deg)`;
        videoElement.classList.remove('rotated', 'rotated180');
        if (rotationAngle === 90) {
          videoElement.classList.add('rotated');
        } else if (rotationAngle === 180) {
          videoElement.classList.add('rotated180');
        }
      }

      function toggleFullscreen() {
        if (videoElement.requestFullscreen) {
          videoElement.requestFullscreen();
        } else if (videoElement.mozRequestFullScreen) {
          videoElement.mozRequestFullScreen();
        } else if (videoElement.webkitRequestFullscreen) {
          videoElement.webkitRequestFullscreen();
        } else if (videoElement.msRequestFullscreen) {
          videoElement.msRequestFullscreen();
        }
      }

      populateDevices();
    </script>
  </div>
</body>

</html>
